@model IEnumerable<Dictionary<string, BussinessObjects.Models.Event>>

@{
    ViewData["Title"] = "Index";
    var dropdown = ViewBag.WeekDropdown;
    var days = ViewBag.WeekDays;
    var daysOfWeek = ViewBag.DaysOfWeek;
    var clubID = ViewBag.ClubID;
    var EventModels = Model.ToList<Dictionary<string, BussinessObjects.Models.Event>>();
    var timeSlots = new List<string> { "Morning", "Noon", "Afternoon", "Evening" };
}

<h1 class="mb-4 text-primary fw-bold">📅 Event Schedule</h1>

<!-- Week Selection Form -->
<div class="mb-4 p-3 bg-light border rounded shadow-sm">
    <form id="weekForm" asp-action="Index" method="get" class="d-flex align-items-center gap-3">
        <label class="fw-bold text-secondary">Select a Week:</label>
        <select name="week" asp-items="dropdown" class="form-select w-auto border-primary" onchange="this.form.submit()">
            <option value="">-- Select Week --</option>
        </select>
        <input type="hidden" value="@clubID" name="clubID" />
    </form>
</div>

<!-- Event Table -->
<div class="table-responsive">
    <table class="table table-hover table-bordered text-center align-middle shadow-sm">
        <thead class="table-primary">
            <tr>
                <th class="fw-bold">Time Slot</th>
                @foreach (var day in days)
                {
                    <th class="fw-bold">@Html.Raw(day)</th>
                }
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < timeSlots.Count; i++)
            {
                <tr>
                    <td class="fw-bold text-primary">@timeSlots[i]</td>
                    @foreach (var dayOfWeek in daysOfWeek)
                    {
                        <td>
                            @if (EventModels[i].ContainsKey(dayOfWeek) && EventModels[i][dayOfWeek] != null)
                            {
                                var eventItem = EventModels[i][dayOfWeek];
                                <a asp-action="Details" asp-route-id="@eventItem.EventId">
                                    <div class="p-2 border rounded bg-white shadow-sm text-start" >
                                        <h6 class="text-dark fw-bold">📌 @Html.Raw(eventItem.EventTitle)</h6>
                                        <p class="text-muted mb-1"><strong>🧑 Created by:</strong> @(eventItem.CreatedByNavigation?.User?.Username ?? "N/A")</p>
                                        <p class="text-muted"><strong>⏰ Time:</strong> @eventItem.EventDate.ToString("HH:mm")</p>
                                    </div>
                                </a>
                                <a asp-action="Delete" asp-route-id="@eventItem.EventId" class="btn btn-danger btn-sm"
                                   onclick="return confirm('Are you sure you want to delete this event?');">
                                    <i class="fas fa-trash-alt"></i> Delete
                                </a>
                            }
                            else
                            {
                                <span class="text-muted fst-italic">No Event</span>
                            }
                        </td>
                    }
                </tr>
            }
        </tbody>
    </table>
</div>
